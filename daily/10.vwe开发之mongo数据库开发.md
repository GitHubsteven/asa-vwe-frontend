##### 链接数据库和CRUD #####
**分析**

如果你经历过java开发的话，那么分析一下java和mysql之间的链接，也许我们可以借鉴下，当前我们有如下角色：
1. mysql（MongoDB）
2. 后台语言Java(Js)

在java中，实现这个链接的一般有两种方式
1. Mybatis + MySQL Connector/J
2. Hibernate + MySQL Connector/J
3. xxxx + MySQL Connector/J

我们相信对于js连通MongoDB，也有类似的中间工具，没错，那就是--Mongoose。

1.安装一些依赖
```
npm i --save-dev body-parser cors
```
2. 安装mongoose
```
npm i mongoose --save-dev
```
3. 在server-dev.js中引入
```
//链接数据库
let bodyParser = require('body-parser');
let cors = require('cors');
let mongoose = require('mongoose');
//other code
//使用引入
//表示数据格式以json方式来传递？
app.use(bodyParser.json());
app.use(cors());
//服务器连接数据库，数据库不需要先建立
let DB_URL = "mongodb://localhost:27017/blogs";
mongoose.connect(DB_URL, {useNewUrlParser: true})
  .then(() => {
      console.log("connect successfully!")
    }, (err) => {
      console.log('error when connect to mongo db!' + err)
    }
  );
```
4. 为了能运行正常，你必须现在本地或者DB_URL的主机先安装了MongoDB。执行编译运行，如果正常的话，terminal会出现connect successfully.
接下来我们需要定义类似java中的链接bean对象--schema对象。新建文件夹./src/models，新建Blog.js,代码如下：
```
   let mongoose = require('mongoose');
   let Schema = mongoose.Schema;
   // import CommentModel from './Comment'

   let BlogSchema = new Schema({
     title: String,
     author: String,
     body: String,
     // comments: [CommentModel],
     date: {type: Date, default: Date.now},
   });

   module.exports = mongoose.model('BlogModel', BlogSchema);
```
在这里，我们可以先通过mongoose的[Api文档](https://mongoosejs.com/docs/index.html)了解schema,model,document,这里粗略的介绍下
- schema，行为何属性的定义集合（类似于java中的接口或者抽象类），它生成model
- model， 由schema调用生成，具有schema定义的属性和行为，但增加了一些公共的和mongodb交互的方法，可直接和mongodb交互（通常我们也是通过这个来交互的）
- document，model的一个是实例，保存数据，具有model的特性。

上面是连接数据库，下面是实现CRUD(增删改查)

1. create
1. 接下来，我们需要生成一个blog
    1. 新建一个vue页面，名字叫做，blog-add.vue,代码如下：
    ```
        <template>
        <div>
            <table>
                <tr>
                    <td colspan="3">
                        <label> title:</label>
                        <label>
                            <input type="text" v-model="blog.title" style="width: 90%">
                        </label>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label>
                            <textarea v-model="blog.context" class="part"></textarea>
                        </label>
                    </td>
                    <td><label><---简单的分割线----></label></td>
                    <td>
                        <p v-html="convertMarkdown(blog.context)" class="part"></p>
                    </td>
                </tr>
            </table>
            <button class="btn btn-primary" v-if="!blog._id" @click="create()"><span>Create Blog</span></button>
            <button class="btn btn-primary" v-if="blog._id" @click="update()"><span>Update Blog</span></button>
        </div>
    </template>
     import {Converter} from 'showdown';
        import {ApiService} from "../js/apiService";
        import * as _ from "lodash";
    
        let converter = new Converter({tables: true});
        let apiService = new ApiService();
    
        // converter.setFlavor('github');
        let author = "asa.x";
    
        export default {
            name: "blog-add",
            data: function () {
                return {
                    blog: {
                        title: "blog-title",
                        context: "hello,world",
                        author: author,
                        id: null
                    },
                }
            },
            methods: {
                create() {
                    apiService.createBlog(this.blog).then(res => {
                        if (!res._id) {
                            window.alert("res:" + res.message);
                        } else {
                            //页面跳转
                            this.$router.push({
                                path: '/blog-list',
                                name: 'BlogList'
                            })
                        }
                    })
                },
                //markdown文本转化
                convertMarkdown(context) {
                    return converter.makeHtml(context);
                },
                //初始化，update操作也在这个页面，暂时不管
                init() {
                    let vblog = this.$route.params.blog;
                    if (vblog) {
                        Object.assign(this.blog, vblog);
                    }
                },
                
            mounted() {
                this.init()
            }
        }
        </script>
        
        <style type="text/css" scoped>
        
        </style>
   ```
   重新打开页面
   
   输入markdown语法，那么就可以转化为可识别的文本。
   
   




